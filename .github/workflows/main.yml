name: CI
on: [push]

jobs:
  build_linux:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - uses: krdlab/setup-haxe@v1
        with:
          haxe-version: 4.3.0
        
      - name: Install haxelibs
        run: |
          haxe -version
          haxelib install gm2d
          haxelib install format
          haxelib install nme-toolkit
          haxelib install hxcpp
          
      - name: Build Tool
        run: |
          pwd
          ls
          cd tools/nme
          haxe compile.hxml
          
      - name: Install SDL libraries
        run: |
          sudo apt-get -y install libasound2-dev libpulse-dev  libaudio-dev libjack-dev libsndio-dev libsamplerate0-dev libx11-dev libxext-dev libxrandr-dev libxcursor-dev libxfixes-dev libxi-dev libxss-dev libwayland-dev libxkbcommon-dev libdrm-dev libgbm-dev libgl1-mesa-dev libgles2-mesa-dev libegl1-mesa-dev libxcursor-dev libxrandr-dev libxinerama-dev libxi-dev
        
      - name: Build Project
        run: |
          cd project
          haxelib run hxcpp ToolkitBuild.xml
          
      - name: Archive Results
        uses: actions/upload-artifact@v3
        with:
          name: linux-64-nme.ndll
          path: ndll/Linux64/nme.ndll
          
  build_windows:
    runs-on: windows-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - uses: krdlab/setup-haxe@v1
        with:
          haxe-version: 4.3.0
        
      - name: Install haxelibs
        run: |
          haxe -version
          haxelib install gm2d
          haxelib install format
          haxelib install nme-toolkit
          haxelib install hxcpp
          
      - name: Build Tool
        run: |
          pwd
          ls
          cd tools/nme
          haxe compile.hxml
          
      - name: Build Project
        run: |
          cd project
          haxelib run hxcpp ToolkitBuild.xml -DHXCPP_M64
          
      - name: Archive Results
        uses: actions/upload-artifact@v3
        with:
          name: windows-64-nme.ndll
          path: ndll/Windows64/nme.ndll
          
  build_mac:
    runs-on: macos-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - uses: krdlab/setup-haxe@v1
        with:
          haxe-version: 4.3.0
        
      - name: Install haxelibs
        run: |
          haxe -version
          haxelib install gm2d
          haxelib install format
          haxelib install nme-toolkit
          haxelib install hxcpp
          
      - name: Build Tool
        run: |
          pwd
          ls
          cd tools/nme
          haxe compile.hxml
          
      - name: Check XCode
        run: xcode-select -p
          
      - name: Build Project
        run: |
          cd project
          haxelib run hxcpp ToolkitBuild.xml -DHXCPP_M64
          
      - name: Archive Results
        uses: actions/upload-artifact@v3
        with:
          name: mac-64-nme.ndll
          path: ndll/Mac64/nme.ndll
          

      
